import{s}from"./DBDV4xVz.js";async function w(n){let t=s.from("categories").select("*");const{data:a,error:e}=await t;if(e)throw e;return a||[]}async function _(n=100){const{data:t,error:a}=await s.from("transactions").select("id, date, amount, transaction_type, notes, category_id").order("date",{ascending:!1}).order("id",{ascending:!1}).limit(n);if(a)throw a;if(!t)return[];const{data:e}=await s.from("categories").select("id, name, icon"),r=new Map((e==null?void 0:e.map(o=>[o.id,o]))||[]);return t.map(o=>({...o,category:r.get(o.category_id),created_at:o.created_at||new Date().toISOString()}))}async function h(n,t,a,e,r){const{error:o}=await s.from("transactions").insert({date:n,amount:t,category_id:a,transaction_type:e,notes:r});if(o)throw o}async function S(n){const{error:t}=await s.from("transactions").delete().eq("id",n);if(t)throw t}async function $(){const{data:n,error:t}=await s.from("recurring_bills").select("*").order("due_day");if(t)throw t;if(!n)return[];const{data:a}=await s.from("categories").select("id, name, icon"),e=new Map((a==null?void 0:a.map(r=>[r.id,r]))||[]);return n.map(r=>({...r,category:e.get(r.category_id)}))}async function b(n,t,a,e){const{error:r}=await s.from("recurring_bills").insert({name:n,amount:t,due_day:a,category_id:e});if(r)throw r}async function x(n,t){const{error:a}=await s.from("recurring_bills").update({is_active:t?1:0}).eq("id",n);if(a)throw a}async function q(n){const{error:t}=await s.from("recurring_bills").delete().eq("id",n);if(t)throw t}async function M(n,t){let a=s.from("transactions").select("amount, transaction_type");if(n&&t){const i=`${n}-${String(t).padStart(2,"0")}-01`,c=t===12?`${n+1}-01-01`:`${n}-${String(t+1).padStart(2,"0")}-01`;a=a.gte("date",i).lt("date",c)}const{data:e,error:r}=await a;if(r)throw r;if(!e||e.length===0)return{total_income:0,total_expense:0};const o=e.filter(i=>i.transaction_type==="income").reduce((i,c)=>i+c.amount,0),f=e.filter(i=>i.transaction_type==="expense").reduce((i,c)=>i+c.amount,0);return{total_income:o,total_expense:f}}async function v(n="expense",t,a){let e=s.from("transactions").select("amount, category_id, transaction_type");if(t&&a){const d=`${t}-${String(a).padStart(2,"0")}-01`,l=a===12?`${t+1}-01-01`:`${t}-${String(a+1).padStart(2,"0")}-01`;e=e.gte("date",d).lt("date",l)}else t&&(e=e.gte("date",`${t}-01-01`).lt("date",`${t+1}-01-01`));const{data:r,error:o}=await e;if(o)throw o;if(!r)return[];const f=r.filter(d=>d.transaction_type===n);if(f.length===0)return[];const{data:i}=await s.from("categories").select("id, name, icon");if(!i)return[];const c=new Map;for(const d of f)c.set(d.category_id,(c.get(d.category_id)||0)+d.amount);const g=[];for(const[d,l]of c){const u=i.find(m=>m.id===d);u&&g.push({name:u.name,icon:u.icon,total:l})}return g.sort((d,l)=>l.total-d.total)}const p={Food:["grocery","restaurant","food","coffee","cafe","supermarket"],Transportation:["gas","fuel","uber","lyft","parking","transit"],Utilities:["electric","water","gas","internet","phone","utility"],Entertainment:["netflix","spotify","movie","game","streaming"],Rent:["rent","lease"],Insurance:["insurance","premium"],Healthcare:["medical","doctor","pharmacy","health"],Phone:["mobile","cell","phone"],Savings:["savings","investment","deposit"]};function B(n,t){var r;const a=n.toLowerCase();for(const[o,f]of Object.entries(p))if(f.some(i=>a.includes(i))){const i=t.find(c=>c.name===o);if(i)return i.id}const e=t.find(o=>o.name==="Other");return(e==null?void 0:e.id)||((r=t[0])==null?void 0:r.id)}export{M as a,_ as b,$ as c,v as d,h as e,q as f,w as g,b as h,B as i,S as j,x as t};
