import{s as we,n as fe,o as Le,r as je,a as re}from"../chunks/DSOgNidj.js";import{S as Ae,i as Ne,d,a as R,b as f,v as ne,k as I,l as Fe,g as B,c as m,e as S,m as ee,j as H,h as g,s as Z,f as Q,t as W,p as ie,r as le,o as ce,q as se,u as pe}from"../chunks/BEA7QHMY.js";import{e as x}from"../chunks/D6YF6ztN.js";import{g as Oe}from"../chunks/D9W0EZNd.js";import{g as Pe,i as Be,e as He}from"../chunks/BkX9Jbjf.js";function ve(l,e,t){const s=l.slice();return s[17]=e[t],s}function me(l,e,t){const s=l.slice();return s[20]=e[t],s}function ge(l,e,t){const s=l.slice();return s[20]=e[t],s}function be(l,e,t){const s=l.slice();return s[20]=e[t],s}function Ce(l){let e,t;return{c(){e=g("div"),t=W(l[1]),this.h()},l(s){e=m(s,"DIV",{class:!0});var n=S(e);t=Q(n,l[1]),n.forEach(d),this.h()},h(){I(e,"class","error")},m(s,n){R(s,e,n),f(e,t)},p(s,n){n&2&&Z(t,s[1])},d(s){s&&d(e)}}}function Ee(l){let e,t;return{c(){e=g("div"),t=W(l[2]),this.h()},l(s){e=m(s,"DIV",{class:!0});var n=S(e);t=Q(n,l[2]),n.forEach(d),this.h()},h(){I(e,"class","success svelte-jlfbge")},m(s,n){R(s,e,n),f(e,t)},p(s,n){n&4&&Z(t,s[2])},d(s){s&&d(e)}}}function Me(l){let e;return{c(){e=W("üìÅ Choose CSV File")},l(t){e=Q(t,"üìÅ Choose CSV File")},m(t,s){R(t,e,s)},p:fe,d(t){t&&d(e)}}}function qe(l){let e,t=l[3].name+"",s;return{c(){e=W("üìÑ "),s=W(t)},l(n){e=Q(n,"üìÑ "),s=Q(n,t)},m(n,i){R(n,e,i),R(n,s,i)},p(n,i){i&8&&t!==(t=n[3].name+"")&&Z(s,t)},d(n){n&&(d(e),d(s))}}}function ke(l){let e,t,s="üìã Column Mapping",n,i,a,k,D="Date Column",N,b,T,h,_,p="Amount Column",u,C,y,O,w,V="Description Column",U,j,M,E,c,F=l[0]?"Importing...":`üì• Import ${l[4].length} Transactions`,v,Y,G,J=x(l[9]),A=[];for(let o=0;o<J.length;o+=1)A[o]=Te(be(l,J,o));let $=x(l[9]),P=[];for(let o=0;o<$.length;o+=1)P[o]=Ie(ge(l,$,o));let te=x(l[9]),q=[];for(let o=0;o<te.length;o+=1)q[o]=De(me(l,te,o));let z=l[5].length>0&&Ve(l);return{c(){e=g("div"),t=g("h3"),t.textContent=s,n=H(),i=g("div"),a=g("div"),k=g("label"),k.textContent=D,N=H(),b=g("select");for(let o=0;o<A.length;o+=1)A[o].c();T=H(),h=g("div"),_=g("label"),_.textContent=p,u=H(),C=g("select");for(let o=0;o<P.length;o+=1)P[o].c();y=H(),O=g("div"),w=g("label"),w.textContent=V,U=H(),j=g("select");for(let o=0;o<q.length;o+=1)q[o].c();M=H(),z&&z.c(),E=H(),c=g("button"),v=W(F),this.h()},l(o){e=m(o,"DIV",{class:!0});var L=S(e);t=m(L,"H3",{class:!0,"data-svelte-h":!0}),ee(t)!=="svelte-e3kp6a"&&(t.textContent=s),n=B(L),i=m(L,"DIV",{class:!0});var r=S(i);a=m(r,"DIV",{class:!0});var K=S(a);k=m(K,"LABEL",{"data-svelte-h":!0}),ee(k)!=="svelte-1ks9712"&&(k.textContent=D),N=B(K),b=m(K,"SELECT",{class:!0});var ue=S(b);for(let X=0;X<A.length;X+=1)A[X].l(ue);ue.forEach(d),K.forEach(d),T=B(r),h=m(r,"DIV",{class:!0});var ae=S(h);_=m(ae,"LABEL",{"data-svelte-h":!0}),ee(_)!=="svelte-s33pnq"&&(_.textContent=p),u=B(ae),C=m(ae,"SELECT",{class:!0});var he=S(C);for(let X=0;X<P.length;X+=1)P[X].l(he);he.forEach(d),ae.forEach(d),r.forEach(d),y=B(L),O=m(L,"DIV",{class:!0});var oe=S(O);w=m(oe,"LABEL",{"data-svelte-h":!0}),ee(w)!=="svelte-1iuf2ic"&&(w.textContent=V),U=B(oe),j=m(oe,"SELECT",{class:!0});var _e=S(j);for(let X=0;X<q.length;X+=1)q[X].l(_e);_e.forEach(d),oe.forEach(d),L.forEach(d),M=B(o),z&&z.l(o),E=B(o),c=m(o,"BUTTON",{class:!0});var de=S(c);v=Q(de,F),de.forEach(d),this.h()},h(){I(t,"class","svelte-jlfbge"),I(b,"class","input"),l[6]===void 0&&re(()=>l[12].call(b)),I(a,"class","form-group"),I(C,"class","input"),l[7]===void 0&&re(()=>l[13].call(C)),I(h,"class","form-group"),I(i,"class","form-row"),I(j,"class","input"),l[8]===void 0&&re(()=>l[14].call(j)),I(O,"class","form-group"),I(e,"class","card mapping-card svelte-jlfbge"),I(c,"class","btn btn-success import-btn svelte-jlfbge"),c.disabled=l[0]},m(o,L){R(o,e,L),f(e,t),f(e,n),f(e,i),f(i,a),f(a,k),f(a,N),f(a,b);for(let r=0;r<A.length;r+=1)A[r]&&A[r].m(b,null);le(b,l[6],!0),f(i,T),f(i,h),f(h,_),f(h,u),f(h,C);for(let r=0;r<P.length;r+=1)P[r]&&P[r].m(C,null);le(C,l[7],!0),f(e,y),f(e,O),f(O,w),f(O,U),f(O,j);for(let r=0;r<q.length;r+=1)q[r]&&q[r].m(j,null);le(j,l[8],!0),R(o,M,L),z&&z.m(o,L),R(o,E,L),R(o,c,L),f(c,v),Y||(G=[ne(b,"change",l[12]),ne(C,"change",l[13]),ne(j,"change",l[14]),ne(c,"click",l[11])],Y=!0)},p(o,L){if(L&512){J=x(o[9]);let r;for(r=0;r<J.length;r+=1){const K=be(o,J,r);A[r]?A[r].p(K,L):(A[r]=Te(K),A[r].c(),A[r].m(b,null))}for(;r<A.length;r+=1)A[r].d(1);A.length=J.length}if(L&576&&le(b,o[6]),L&512){$=x(o[9]);let r;for(r=0;r<$.length;r+=1){const K=ge(o,$,r);P[r]?P[r].p(K,L):(P[r]=Ie(K),P[r].c(),P[r].m(C,null))}for(;r<P.length;r+=1)P[r].d(1);P.length=$.length}if(L&640&&le(C,o[7]),L&512){te=x(o[9]);let r;for(r=0;r<te.length;r+=1){const K=me(o,te,r);q[r]?q[r].p(K,L):(q[r]=De(K),q[r].c(),q[r].m(j,null))}for(;r<q.length;r+=1)q[r].d(1);q.length=te.length}L&768&&le(j,o[8]),o[5].length>0?z?z.p(o,L):(z=Ve(o),z.c(),z.m(E.parentNode,E)):z&&(z.d(1),z=null),L&17&&F!==(F=o[0]?"Importing...":`üì• Import ${o[4].length} Transactions`)&&Z(v,F),L&1&&(c.disabled=o[0])},d(o){o&&(d(e),d(M),d(E),d(c)),ie(A,o),ie(P,o),ie(q,o),z&&z.d(o),Y=!1,je(G)}}}function Te(l){let e,t=l[20]+"",s,n;return{c(){e=g("option"),s=W(t),this.h()},l(i){e=m(i,"OPTION",{});var a=S(e);s=Q(a,t),a.forEach(d),this.h()},h(){e.__value=n=l[20],se(e,e.__value)},m(i,a){R(i,e,a),f(e,s)},p(i,a){a&512&&t!==(t=i[20]+"")&&Z(s,t),a&512&&n!==(n=i[20])&&(e.__value=n,se(e,e.__value))},d(i){i&&d(e)}}}function Ie(l){let e,t=l[20]+"",s,n;return{c(){e=g("option"),s=W(t),this.h()},l(i){e=m(i,"OPTION",{});var a=S(e);s=Q(a,t),a.forEach(d),this.h()},h(){e.__value=n=l[20],se(e,e.__value)},m(i,a){R(i,e,a),f(e,s)},p(i,a){a&512&&t!==(t=i[20]+"")&&Z(s,t),a&512&&n!==(n=i[20])&&(e.__value=n,se(e,e.__value))},d(i){i&&d(e)}}}function De(l){let e,t=l[20]+"",s,n;return{c(){e=g("option"),s=W(t),this.h()},l(i){e=m(i,"OPTION",{});var a=S(e);s=Q(a,t),a.forEach(d),this.h()},h(){e.__value=n=l[20],se(e,e.__value)},m(i,a){R(i,e,a),f(e,s)},p(i,a){a&512&&t!==(t=i[20]+"")&&Z(s,t),a&512&&n!==(n=i[20])&&(e.__value=n,se(e,e.__value))},d(i){i&&d(e)}}}function Ve(l){let e,t,s="üëÄ Preview (First 5 rows)",n,i,a,k,D="<tr><th>Date</th> <th>Amount</th> <th>Description</th></tr>",N,b,T=x(l[5]),h=[];for(let _=0;_<T.length;_+=1)h[_]=Se(ve(l,T,_));return{c(){e=g("div"),t=g("h3"),t.textContent=s,n=H(),i=g("div"),a=g("table"),k=g("thead"),k.innerHTML=D,N=H(),b=g("tbody");for(let _=0;_<h.length;_+=1)h[_].c();this.h()},l(_){e=m(_,"DIV",{class:!0});var p=S(e);t=m(p,"H3",{class:!0,"data-svelte-h":!0}),ee(t)!=="svelte-1fp2b5w"&&(t.textContent=s),n=B(p),i=m(p,"DIV",{class:!0});var u=S(i);a=m(u,"TABLE",{});var C=S(a);k=m(C,"THEAD",{"data-svelte-h":!0}),ee(k)!=="svelte-rx10jy"&&(k.innerHTML=D),N=B(C),b=m(C,"TBODY",{});var y=S(b);for(let O=0;O<h.length;O+=1)h[O].l(y);y.forEach(d),C.forEach(d),u.forEach(d),p.forEach(d),this.h()},h(){I(t,"class","svelte-jlfbge"),I(i,"class","table-container"),I(e,"class","card preview-card svelte-jlfbge")},m(_,p){R(_,e,p),f(e,t),f(e,n),f(e,i),f(i,a),f(a,k),f(a,N),f(a,b);for(let u=0;u<h.length;u+=1)h[u]&&h[u].m(b,null)},p(_,p){if(p&480){T=x(_[5]);let u;for(u=0;u<T.length;u+=1){const C=ve(_,T,u);h[u]?h[u].p(C,p):(h[u]=Se(C),h[u].c(),h[u].m(b,null))}for(;u<h.length;u+=1)h[u].d(1);h.length=T.length}},d(_){_&&d(e),ie(h,_)}}}function Se(l){let e,t,s=l[17][l[6]]+"",n,i,a,k=l[17][l[7]]+"",D,N,b,T=l[17][l[8]]+"",h,_;return{c(){e=g("tr"),t=g("td"),n=W(s),i=H(),a=g("td"),D=W(k),N=H(),b=g("td"),h=W(T),_=H(),this.h()},l(p){e=m(p,"TR",{});var u=S(e);t=m(u,"TD",{});var C=S(t);n=Q(C,s),C.forEach(d),i=B(u),a=m(u,"TD",{class:!0});var y=S(a);D=Q(y,k),y.forEach(d),N=B(u),b=m(u,"TD",{});var O=S(b);h=Q(O,T),O.forEach(d),_=B(u),u.forEach(d),this.h()},h(){var p;I(a,"class","svelte-jlfbge"),pe(a,"expense",parseFloat(((p=l[17][l[7]])==null?void 0:p.replace(/[$,]/g,""))||0)<0)},m(p,u){R(p,e,u),f(e,t),f(t,n),f(e,i),f(e,a),f(a,D),f(e,N),f(e,b),f(b,h),f(e,_)},p(p,u){var C;u&96&&s!==(s=p[17][p[6]]+"")&&Z(n,s),u&160&&k!==(k=p[17][p[7]]+"")&&Z(D,k),u&160&&pe(a,"expense",parseFloat(((C=p[17][p[7]])==null?void 0:C.replace(/[$,]/g,""))||0)<0),u&288&&T!==(T=p[17][p[8]]+"")&&Z(h,T)},d(p){p&&d(e)}}}function Ue(l){let e,t,s,n="üìÅ Import CSV",i,a,k,D,N,b=`Upload a bank CSV export to import transactions. 
      The app will auto-detect columns and categorize based on descriptions.`,T,h,_,p,u,C,y,O,w=l[1]&&Ce(l),V=l[2]&&Ee(l);function U(c,F){return c[3]?qe:Me}let j=U(l),M=j(l),E=l[9].length>0&&ke(l);return{c(){e=H(),t=g("div"),s=g("h1"),s.textContent=n,i=H(),w&&w.c(),a=H(),V&&V.c(),k=H(),D=g("div"),N=g("p"),N.textContent=b,T=H(),h=g("div"),_=g("input"),p=H(),u=g("label"),M.c(),C=H(),E&&E.c(),this.h()},l(c){Fe("svelte-1u7g53n",document.head).forEach(d),e=B(c),t=m(c,"DIV",{class:!0});var v=S(t);s=m(v,"H1",{class:!0,"data-svelte-h":!0}),ee(s)!=="svelte-kvwomw"&&(s.textContent=n),i=B(v),w&&w.l(v),a=B(v),V&&V.l(v),k=B(v),D=m(v,"DIV",{class:!0});var Y=S(D);N=m(Y,"P",{class:!0,"data-svelte-h":!0}),ee(N)!=="svelte-p70p7r"&&(N.textContent=b),T=B(Y),h=m(Y,"DIV",{class:!0});var G=S(h);_=m(G,"INPUT",{type:!0,accept:!0,id:!0,class:!0}),p=B(G),u=m(G,"LABEL",{for:!0,class:!0});var J=S(u);M.l(J),J.forEach(d),G.forEach(d),Y.forEach(d),C=B(v),E&&E.l(v),v.forEach(d),this.h()},h(){document.title="Import CSV - Jim's Finance Tracker",I(s,"class","page-title"),I(N,"class","description svelte-jlfbge"),I(_,"type","file"),I(_,"accept",".csv"),I(_,"id","csv-file"),I(_,"class","svelte-jlfbge"),I(u,"for","csv-file"),I(u,"class","file-label svelte-jlfbge"),I(h,"class","file-input svelte-jlfbge"),I(D,"class","card"),I(t,"class","page")},m(c,F){R(c,e,F),R(c,t,F),f(t,s),f(t,i),w&&w.m(t,null),f(t,a),V&&V.m(t,null),f(t,k),f(t,D),f(D,N),f(D,T),f(D,h),f(h,_),f(h,p),f(h,u),M.m(u,null),f(t,C),E&&E.m(t,null),y||(O=ne(_,"change",l[10]),y=!0)},p(c,[F]){c[1]?w?w.p(c,F):(w=Ce(c),w.c(),w.m(t,a)):w&&(w.d(1),w=null),c[2]?V?V.p(c,F):(V=Ee(c),V.c(),V.m(t,k)):V&&(V.d(1),V=null),j===(j=U(c))&&M?M.p(c,F):(M.d(1),M=j(c),M&&(M.c(),M.m(u,null))),c[9].length>0?E?E.p(c,F):(E=ke(c),E.c(),E.m(t,null)):E&&(E.d(1),E=null)},i:fe,o:fe,d(c){c&&(d(e),d(t)),w&&w.d(),V&&V.d(),M.d(),E&&E.d(),y=!1,O()}}}function ze(l,e,t){let s=!1,n="",i="",a=[],k=null,D=[],N=[],b="",T="",h="",_=[];Le(async()=>{a=await Pe()});function p(V){const U=V.target;U.files&&U.files[0]&&(t(3,k=U.files[0]),u(k))}function u(V){const U=new FileReader;U.onload=j=>{var F;const E=((F=j.target)==null?void 0:F.result).split(`
`).filter(v=>v.trim());if(E.length<2){t(1,n="CSV file is empty or invalid");return}const c=E[0].split(",").map(v=>v.trim().replace(/^"|"$/g,""));t(9,_=c),t(6,b=c.find(v=>/date|day|time/i.test(v))||c[0]),t(7,T=c.find(v=>/amount|sum|value|price|cost/i.test(v))||c.find(v=>/^-?\$?\d/.test(v))||c[1]),t(8,h=c.find(v=>/desc|memo|note|payee|name|merchant|transaction/i.test(v))||c[2]||c[c.length-1]),t(4,D=[]);for(let v=1;v<E.length&&v<=100;v++){const Y=E[v].split(",").map(J=>J.trim().replace(/^"|"$/g,"")),G={};c.forEach((J,A)=>{G[J]=Y[A]||""}),D.push(G)}t(5,N=D.slice(0,5))},U.readAsText(V)}async function C(){var V,U;if(!b||!T||!h||D.length===0){t(1,n="Please map all columns first");return}t(0,s=!0),t(1,n="");try{let j=0;const M=a.filter(c=>c.is_income===0),E=a.filter(c=>c.is_income===1);for(const c of D){const F=c[b],v=parseFloat(c[T].replace(/[$,]/g,"")),Y=c[h];if(isNaN(v))continue;const G=v>0?"income":"expense",J=Math.abs(v);let A;G==="income"?A=((V=E[0])==null?void 0:V.id)||((U=a[0])==null?void 0:U.id):A=Be(Y,a);let $=F;if(!/\d{4}-\d{2}-\d{2}/.test(F)){const P=new Date(F);isNaN(P.getTime())||($=P.toISOString().split("T")[0])}await He($,J,A,G,Y),j++}t(2,i=`Successfully imported ${j} transactions!`),setTimeout(()=>{Oe("/transactions")},1500)}catch(j){t(1,n=j.message)}finally{t(0,s=!1)}}function y(){b=ce(this),t(6,b),t(9,_)}function O(){T=ce(this),t(7,T),t(9,_)}function w(){h=ce(this),t(8,h),t(9,_)}return[s,n,i,k,D,N,b,T,h,_,p,C,y,O,w]}class Ke extends Ae{constructor(e){super(),Ne(this,e,ze,Ue,we,{})}}export{Ke as component};
