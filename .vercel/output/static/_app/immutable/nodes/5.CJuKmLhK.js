import{s as Se,n as ue,o as Ne,r as Ae,a as ce}from"../chunks/DSOgNidj.js";import{S as Me,i as Oe,d as h,a as G,b as c,v as ae,k as L,w as ie,l as He,g as B,c as _,e as D,m as x,j as F,h as p,s as ee,f as Z,t as $,p as re,u as le,o as fe,r as se,q as ve}from"../chunks/BTTWjJDS.js";import{e as te}from"../chunks/D6YF6ztN.js";import{g as Pe}from"../chunks/DfSwdc0w.js";import{g as ye,i as Be,e as Fe}from"../chunks/BlK5NUL5.js";function me(s,e,t){const l=s.slice();return l[17]=e[t],l}function ge(s,e,t){const l=s.slice();return l[20]=e[t],l}function be(s,e,t){const l=s.slice();return l[20]=e[t],l}function Ee(s,e,t){const l=s.slice();return l[20]=e[t],l}function Ce(s){let e,t;return{c(){e=p("div"),t=$(s[1]),this.h()},l(l){e=_(l,"DIV",{class:!0});var a=D(e);t=Z(a,s[1]),a.forEach(h),this.h()},h(){L(e,"class","error")},m(l,a){G(l,e,a),c(e,t)},p(l,a){a&2&&ee(t,l[1])},d(l){l&&h(e)}}}function Te(s){let e,t;return{c(){e=p("div"),t=$(s[2]),this.h()},l(l){e=_(l,"DIV",{class:!0});var a=D(e);t=Z(a,s[2]),a.forEach(h),this.h()},h(){L(e,"class","success")},m(l,a){G(l,e,a),c(e,t)},p(l,a){a&4&&ee(t,l[2])},d(l){l&&h(e)}}}function qe(s){let e,t="Click to upload",l;return{c(){e=p("strong"),e.textContent=t,l=$(" or drag and drop")},l(a){e=_(a,"STRONG",{"data-svelte-h":!0}),x(e)!=="svelte-1r0qvlo"&&(e.textContent=t),l=Z(a," or drag and drop")},m(a,n){G(a,e,n),G(a,l,n)},p:ue,d(a){a&&(h(e),h(l))}}}function Re(s){let e,t=s[3].name+"",l;return{c(){e=p("strong"),l=$(t)},l(a){e=_(a,"STRONG",{});var n=D(e);l=Z(n,t),n.forEach(h)},m(a,n){G(a,e,n),c(e,l)},p(a,n){n&8&&t!==(t=a[3].name+"")&&ee(l,t)},d(a){a&&h(e)}}}function ke(s){let e,t,l='<h3 class="card-title">ðŸ“‹ Column Mapping</h3>',a,n,o,I,w="Date Column",M,b,V,u,d,m="Amount Column",f,g,J,H,U,K="Description Column",R,y,O,k,C,z=s[0]?"Importing...":`ðŸ“¥ Import ${s[4].length} Transactions`,v,S,T,P=te(s[9]),E=[];for(let i=0;i<P.length;i+=1)E[i]=Ie(Ee(s,P,i));let Y=te(s[9]),N=[];for(let i=0;i<Y.length;i+=1)N[i]=De(be(s,Y,i));let W=te(s[9]),q=[];for(let i=0;i<W.length;i+=1)q[i]=Ve(ge(s,W,i));let j=s[5].length>0&&Le(s);return{c(){e=p("div"),t=p("div"),t.innerHTML=l,a=F(),n=p("div"),o=p("div"),I=p("label"),I.textContent=w,M=F(),b=p("select");for(let i=0;i<E.length;i+=1)E[i].c();V=F(),u=p("div"),d=p("label"),d.textContent=m,f=F(),g=p("select");for(let i=0;i<N.length;i+=1)N[i].c();J=F(),H=p("div"),U=p("label"),U.textContent=K,R=F(),y=p("select");for(let i=0;i<q.length;i+=1)q[i].c();O=F(),j&&j.c(),k=F(),C=p("button"),v=$(z),this.h()},l(i){e=_(i,"DIV",{class:!0});var A=D(e);t=_(A,"DIV",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-i6d7o8"&&(t.innerHTML=l),a=B(A),n=_(A,"DIV",{class:!0});var r=D(n);o=_(r,"DIV",{class:!0});var Q=D(o);I=_(Q,"LABEL",{"data-svelte-h":!0}),x(I)!=="svelte-1ks9712"&&(I.textContent=w),M=B(Q),b=_(Q,"SELECT",{class:!0});var he=D(b);for(let X=0;X<E.length;X+=1)E[X].l(he);he.forEach(h),Q.forEach(h),V=B(r),u=_(r,"DIV",{class:!0});var ne=D(u);d=_(ne,"LABEL",{"data-svelte-h":!0}),x(d)!=="svelte-s33pnq"&&(d.textContent=m),f=B(ne),g=_(ne,"SELECT",{class:!0});var de=D(g);for(let X=0;X<N.length;X+=1)N[X].l(de);de.forEach(h),ne.forEach(h),r.forEach(h),J=B(A),H=_(A,"DIV",{class:!0,style:!0});var oe=D(H);U=_(oe,"LABEL",{"data-svelte-h":!0}),x(U)!=="svelte-1iuf2ic"&&(U.textContent=K),R=B(oe),y=_(oe,"SELECT",{class:!0});var _e=D(y);for(let X=0;X<q.length;X+=1)q[X].l(_e);_e.forEach(h),oe.forEach(h),A.forEach(h),O=B(i),j&&j.l(i),k=B(i),C=_(i,"BUTTON",{class:!0});var pe=D(C);v=Z(pe,z),pe.forEach(h),this.h()},h(){L(t,"class","card-header"),L(b,"class","input"),s[6]===void 0&&ce(()=>s[12].call(b)),L(o,"class","form-group"),L(g,"class","input"),s[7]===void 0&&ce(()=>s[13].call(g)),L(u,"class","form-group"),L(n,"class","form-row"),L(y,"class","input"),s[8]===void 0&&ce(()=>s[14].call(y)),L(H,"class","form-group"),ie(H,"margin-bottom","0"),L(e,"class","card mapping-card animate-fade-in stagger-1 svelte-1hswut0"),L(C,"class","btn btn-success import-btn animate-fade-in stagger-3 svelte-1hswut0"),C.disabled=s[0]},m(i,A){G(i,e,A),c(e,t),c(e,a),c(e,n),c(n,o),c(o,I),c(o,M),c(o,b);for(let r=0;r<E.length;r+=1)E[r]&&E[r].m(b,null);le(b,s[6],!0),c(n,V),c(n,u),c(u,d),c(u,f),c(u,g);for(let r=0;r<N.length;r+=1)N[r]&&N[r].m(g,null);le(g,s[7],!0),c(e,J),c(e,H),c(H,U),c(H,R),c(H,y);for(let r=0;r<q.length;r+=1)q[r]&&q[r].m(y,null);le(y,s[8],!0),G(i,O,A),j&&j.m(i,A),G(i,k,A),G(i,C,A),c(C,v),S||(T=[ae(b,"change",s[12]),ae(g,"change",s[13]),ae(y,"change",s[14]),ae(C,"click",s[11])],S=!0)},p(i,A){if(A&512){P=te(i[9]);let r;for(r=0;r<P.length;r+=1){const Q=Ee(i,P,r);E[r]?E[r].p(Q,A):(E[r]=Ie(Q),E[r].c(),E[r].m(b,null))}for(;r<E.length;r+=1)E[r].d(1);E.length=P.length}if(A&576&&le(b,i[6]),A&512){Y=te(i[9]);let r;for(r=0;r<Y.length;r+=1){const Q=be(i,Y,r);N[r]?N[r].p(Q,A):(N[r]=De(Q),N[r].c(),N[r].m(g,null))}for(;r<N.length;r+=1)N[r].d(1);N.length=Y.length}if(A&640&&le(g,i[7]),A&512){W=te(i[9]);let r;for(r=0;r<W.length;r+=1){const Q=ge(i,W,r);q[r]?q[r].p(Q,A):(q[r]=Ve(Q),q[r].c(),q[r].m(y,null))}for(;r<q.length;r+=1)q[r].d(1);q.length=W.length}A&768&&le(y,i[8]),i[5].length>0?j?j.p(i,A):(j=Le(i),j.c(),j.m(k.parentNode,k)):j&&(j.d(1),j=null),A&17&&z!==(z=i[0]?"Importing...":`ðŸ“¥ Import ${i[4].length} Transactions`)&&ee(v,z),A&1&&(C.disabled=i[0])},d(i){i&&(h(e),h(O),h(k),h(C)),re(E,i),re(N,i),re(q,i),j&&j.d(i),S=!1,Ae(T)}}}function Ie(s){let e,t=s[20]+"",l,a;return{c(){e=p("option"),l=$(t),this.h()},l(n){e=_(n,"OPTION",{});var o=D(e);l=Z(o,t),o.forEach(h),this.h()},h(){e.__value=a=s[20],se(e,e.__value)},m(n,o){G(n,e,o),c(e,l)},p(n,o){o&512&&t!==(t=n[20]+"")&&ee(l,t),o&512&&a!==(a=n[20])&&(e.__value=a,se(e,e.__value))},d(n){n&&h(e)}}}function De(s){let e,t=s[20]+"",l,a;return{c(){e=p("option"),l=$(t),this.h()},l(n){e=_(n,"OPTION",{});var o=D(e);l=Z(o,t),o.forEach(h),this.h()},h(){e.__value=a=s[20],se(e,e.__value)},m(n,o){G(n,e,o),c(e,l)},p(n,o){o&512&&t!==(t=n[20]+"")&&ee(l,t),o&512&&a!==(a=n[20])&&(e.__value=a,se(e,e.__value))},d(n){n&&h(e)}}}function Ve(s){let e,t=s[20]+"",l,a;return{c(){e=p("option"),l=$(t),this.h()},l(n){e=_(n,"OPTION",{});var o=D(e);l=Z(o,t),o.forEach(h),this.h()},h(){e.__value=a=s[20],se(e,e.__value)},m(n,o){G(n,e,o),c(e,l)},p(n,o){o&512&&t!==(t=n[20]+"")&&ee(l,t),o&512&&a!==(a=n[20])&&(e.__value=a,se(e,e.__value))},d(n){n&&h(e)}}}function Le(s){let e,t,l='<h3 class="card-title">ðŸ‘€ Preview (First 5 rows)</h3>',a,n,o,I,w="<tr><th>Date</th> <th>Amount</th> <th>Description</th></tr>",M,b,V=te(s[5]),u=[];for(let d=0;d<V.length;d+=1)u[d]=we(me(s,V,d));return{c(){e=p("div"),t=p("div"),t.innerHTML=l,a=F(),n=p("div"),o=p("table"),I=p("thead"),I.innerHTML=w,M=F(),b=p("tbody");for(let d=0;d<u.length;d+=1)u[d].c();this.h()},l(d){e=_(d,"DIV",{class:!0});var m=D(e);t=_(m,"DIV",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-19oqoz2"&&(t.innerHTML=l),a=B(m),n=_(m,"DIV",{class:!0});var f=D(n);o=_(f,"TABLE",{});var g=D(o);I=_(g,"THEAD",{"data-svelte-h":!0}),x(I)!=="svelte-rx10jy"&&(I.innerHTML=w),M=B(g),b=_(g,"TBODY",{});var J=D(b);for(let H=0;H<u.length;H+=1)u[H].l(J);J.forEach(h),g.forEach(h),f.forEach(h),m.forEach(h),this.h()},h(){L(t,"class","card-header"),L(n,"class","table-container"),L(e,"class","card preview-card animate-fade-in stagger-2 svelte-1hswut0")},m(d,m){G(d,e,m),c(e,t),c(e,a),c(e,n),c(n,o),c(o,I),c(o,M),c(o,b);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(b,null)},p(d,m){if(m&480){V=te(d[5]);let f;for(f=0;f<V.length;f+=1){const g=me(d,V,f);u[f]?u[f].p(g,m):(u[f]=we(g),u[f].c(),u[f].m(b,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=V.length}},d(d){d&&h(e),re(u,d)}}}function we(s){let e,t,l=s[17][s[6]]+"",a,n,o,I=s[17][s[7]]+"",w,M,b,V=s[17][s[8]]+"",u,d;return{c(){e=p("tr"),t=p("td"),a=$(l),n=F(),o=p("td"),w=$(I),M=F(),b=p("td"),u=$(V),d=F(),this.h()},l(m){e=_(m,"TR",{});var f=D(e);t=_(f,"TD",{});var g=D(t);a=Z(g,l),g.forEach(h),n=B(f),o=_(f,"TD",{class:!0});var J=D(o);w=Z(J,I),J.forEach(h),M=B(f),b=_(f,"TD",{});var H=D(b);u=Z(H,V),H.forEach(h),d=B(f),f.forEach(h),this.h()},h(){var m;L(o,"class","svelte-1hswut0"),ve(o,"expense",parseFloat(((m=s[17][s[7]])==null?void 0:m.replace(/[$,]/g,""))||0)<0)},m(m,f){G(m,e,f),c(e,t),c(t,a),c(e,n),c(e,o),c(o,w),c(e,M),c(e,b),c(b,u),c(e,d)},p(m,f){var g;f&96&&l!==(l=m[17][m[6]]+"")&&ee(a,l),f&160&&I!==(I=m[17][m[7]]+"")&&ee(w,I),f&160&&ve(o,"expense",parseFloat(((g=m[17][m[7]])==null?void 0:g.replace(/[$,]/g,""))||0)<0),f&288&&V!==(V=m[17][m[8]]+"")&&ee(u,V)},d(m){m&&h(e)}}}function ze(s){let e,t,l,a='<h1 class="page-title">Import CSV</h1> <p class="page-subtitle">Import transactions from your bank</p>',n,o,I,w,M,b="Upload a bank CSV export. The app will auto-detect columns and categorize based on descriptions.",V,u,d,m,f,g,J="ðŸ“",H,U,K,R,y,O=s[1]&&Ce(s),k=s[2]&&Te(s);function C(T,P){return T[3]?Re:qe}let z=C(s),v=z(s),S=s[9].length>0&&ke(s);return{c(){e=F(),t=p("div"),l=p("header"),l.innerHTML=a,n=F(),O&&O.c(),o=F(),k&&k.c(),I=F(),w=p("div"),M=p("p"),M.textContent=b,V=F(),u=p("div"),d=p("input"),m=F(),f=p("label"),g=p("span"),g.textContent=J,H=F(),U=p("span"),v.c(),K=F(),S&&S.c(),this.h()},l(T){He("svelte-ogr8i7",document.head).forEach(h),e=B(T),t=_(T,"DIV",{class:!0});var E=D(t);l=_(E,"HEADER",{class:!0,"data-svelte-h":!0}),x(l)!=="svelte-1ghwfa0"&&(l.innerHTML=a),n=B(E),O&&O.l(E),o=B(E),k&&k.l(E),I=B(E),w=_(E,"DIV",{class:!0});var Y=D(w);M=_(Y,"P",{style:!0,"data-svelte-h":!0}),x(M)!=="svelte-1lhuqy1"&&(M.textContent=b),V=B(Y),u=_(Y,"DIV",{class:!0});var N=D(u);d=_(N,"INPUT",{type:!0,accept:!0,id:!0}),m=B(N),f=_(N,"LABEL",{for:!0,class:!0});var W=D(f);g=_(W,"SPAN",{class:!0,"data-svelte-h":!0}),x(g)!=="svelte-1bmcvhm"&&(g.textContent=J),H=B(W),U=_(W,"SPAN",{class:!0});var q=D(U);v.l(q),q.forEach(h),W.forEach(h),N.forEach(h),Y.forEach(h),K=B(E),S&&S.l(E),E.forEach(h),this.h()},h(){document.title="Import CSV - Jim's Finance",L(l,"class","page-header"),ie(M,"color","var(--color-text-secondary)"),ie(M,"margin-top","0"),ie(M,"margin-bottom","var(--space-md)"),L(d,"type","file"),L(d,"accept",".csv"),L(d,"id","csv-file"),L(g,"class","file-label-icon"),L(U,"class","file-label-text"),L(f,"for","csv-file"),L(f,"class","file-label"),L(u,"class","file-input-wrapper"),L(w,"class","card animate-fade-in"),L(t,"class","page")},m(T,P){G(T,e,P),G(T,t,P),c(t,l),c(t,n),O&&O.m(t,null),c(t,o),k&&k.m(t,null),c(t,I),c(t,w),c(w,M),c(w,V),c(w,u),c(u,d),c(u,m),c(u,f),c(f,g),c(f,H),c(f,U),v.m(U,null),c(t,K),S&&S.m(t,null),R||(y=ae(d,"change",s[10]),R=!0)},p(T,[P]){T[1]?O?O.p(T,P):(O=Ce(T),O.c(),O.m(t,o)):O&&(O.d(1),O=null),T[2]?k?k.p(T,P):(k=Te(T),k.c(),k.m(t,I)):k&&(k.d(1),k=null),z===(z=C(T))&&v?v.p(T,P):(v.d(1),v=z(T),v&&(v.c(),v.m(U,null))),T[9].length>0?S?S.p(T,P):(S=ke(T),S.c(),S.m(t,null)):S&&(S.d(1),S=null)},i:ue,o:ue,d(T){T&&(h(e),h(t)),O&&O.d(),k&&k.d(),v.d(),S&&S.d(),R=!1,y()}}}function Ue(s,e,t){let l=!1,a="",n="",o=[],I=null,w=[],M=[],b="",V="",u="",d=[];Ne(async()=>{o=await ye()});function m(K){const R=K.target;R.files&&R.files[0]&&(t(3,I=R.files[0]),f(I))}function f(K){const R=new FileReader;R.onload=y=>{var z;const k=((z=y.target)==null?void 0:z.result).split(`
`).filter(v=>v.trim());if(k.length<2){t(1,a="CSV file is empty or invalid");return}const C=k[0].split(",").map(v=>v.trim().replace(/^"|"$/g,""));t(9,d=C),t(6,b=C.find(v=>/date|day|time/i.test(v))||C[0]),t(7,V=C.find(v=>/amount|sum|value|price|cost/i.test(v))||C.find(v=>/^-?\$?\d/.test(v))||C[1]),t(8,u=C.find(v=>/desc|memo|note|payee|name|merchant|transaction/i.test(v))||C[2]||C[C.length-1]),t(4,w=[]);for(let v=1;v<k.length&&v<=100;v++){const S=k[v].split(",").map(P=>P.trim().replace(/^"|"$/g,"")),T={};C.forEach((P,E)=>{T[P]=S[E]||""}),w.push(T)}t(5,M=w.slice(0,5))},R.readAsText(K)}async function g(){var K,R;if(!b||!V||!u||w.length===0){t(1,a="Please map all columns first");return}t(0,l=!0),t(1,a="");try{let y=0;const O=o.filter(C=>C.is_income===0),k=o.filter(C=>C.is_income===1);for(const C of w){const z=C[b],v=parseFloat(C[V].replace(/[$,]/g,"")),S=C[u];if(isNaN(v))continue;const T=v>0?"income":"expense",P=Math.abs(v);let E;T==="income"?E=((K=k[0])==null?void 0:K.id)||((R=o[0])==null?void 0:R.id):E=Be(S,o);let Y=z;if(!/\d{4}-\d{2}-\d{2}/.test(z)){const N=new Date(z);isNaN(N.getTime())||(Y=N.toISOString().split("T")[0])}await Fe(Y,P,E,T,S),y++}t(2,n=`Successfully imported ${y} transactions!`),setTimeout(()=>{Pe("/transactions")},1500)}catch(y){t(1,a=y.message)}finally{t(0,l=!1)}}function J(){b=fe(this),t(6,b),t(9,d)}function H(){V=fe(this),t(7,V),t(9,d)}function U(){u=fe(this),t(8,u),t(9,d)}return[l,a,n,I,w,M,b,V,u,d,m,g,J,H,U]}class Qe extends Me{constructor(e){super(),Oe(this,e,Ue,ze,Se,{})}}export{Qe as component};
