import { c as create_ssr_component, e as each, d as add_attribute, f as escape } from "../../../chunks/ssr.js";
import "@sveltejs/kit/internal";
import "../../../chunks/exports.js";
import "../../../chunks/utils.js";
import "@sveltejs/kit/internal/server";
import "../../../chunks/state.svelte.js";
import "../../../chunks/supabase.js";
const css = {
  code: ".mapping-card.svelte-1hswut0.svelte-1hswut0,.preview-card.svelte-1hswut0.svelte-1hswut0{margin-bottom:var(--space-lg)}.preview-card.svelte-1hswut0 td.expense.svelte-1hswut0{color:var(--color-expense)}.import-btn.svelte-1hswut0.svelte-1hswut0{width:100%}",
  map: '{"version":3,"file":"+page.svelte","sources":["+page.svelte"],"sourcesContent":["<script lang=\\"ts\\">import { onMount } from \\"svelte\\";\\nimport { goto } from \\"$app/navigation\\";\\nimport { addTransaction, getCategories, autoCategorize } from \\"$lib/api\\";\\nlet loading = false;\\nlet error = \\"\\";\\nlet success = \\"\\";\\nlet categories = [];\\nlet file = null;\\nlet csvData = [];\\nlet previewData = [];\\nlet dateColumn = \\"\\";\\nlet amountColumn = \\"\\";\\nlet descColumn = \\"\\";\\nlet columns = [];\\nonMount(async () => {\\n  categories = await getCategories();\\n});\\nfunction handleFileSelect(event) {\\n  const input = event.target;\\n  if (input.files && input.files[0]) {\\n    file = input.files[0];\\n    parseCSV(file);\\n  }\\n}\\nfunction parseCSV(file2) {\\n  const reader = new FileReader();\\n  reader.onload = (e) => {\\n    const text = e.target?.result;\\n    const lines = text.split(\\"\\\\n\\").filter((l) => l.trim());\\n    if (lines.length < 2) {\\n      error = \\"CSV file is empty or invalid\\";\\n      return;\\n    }\\n    const headers = lines[0].split(\\",\\").map((h) => h.trim().replace(/^\\"|\\"$/g, \\"\\"));\\n    columns = headers;\\n    dateColumn = headers.find(\\n      (h) => /date|day|time/i.test(h)\\n    ) || headers[0];\\n    amountColumn = headers.find(\\n      (h) => /amount|sum|value|price|cost/i.test(h)\\n    ) || headers.find((h) => /^-?\\\\$?\\\\d/.test(h)) || headers[1];\\n    descColumn = headers.find(\\n      (h) => /desc|memo|note|payee|name|merchant|transaction/i.test(h)\\n    ) || headers[2] || headers[headers.length - 1];\\n    csvData = [];\\n    for (let i = 1; i < lines.length && i <= 100; i++) {\\n      const values = lines[i].split(\\",\\").map((v) => v.trim().replace(/^\\"|\\"$/g, \\"\\"));\\n      const row = {};\\n      headers.forEach((h, idx) => {\\n        row[h] = values[idx] || \\"\\";\\n      });\\n      csvData.push(row);\\n    }\\n    previewData = csvData.slice(0, 5);\\n  };\\n  reader.readAsText(file2);\\n}\\nasync function handleImport() {\\n  if (!dateColumn || !amountColumn || !descColumn || csvData.length === 0) {\\n    error = \\"Please map all columns first\\";\\n    return;\\n  }\\n  loading = true;\\n  error = \\"\\";\\n  try {\\n    let added = 0;\\n    const expenseCats = categories.filter((c) => c.is_income === 0);\\n    const incomeCats = categories.filter((c) => c.is_income === 1);\\n    for (const row of csvData) {\\n      const dateVal = row[dateColumn];\\n      const amountVal = parseFloat(row[amountColumn].replace(/[$,]/g, \\"\\"));\\n      const descVal = row[descColumn];\\n      if (isNaN(amountVal)) continue;\\n      const txType = amountVal > 0 ? \\"income\\" : \\"expense\\";\\n      const absAmount = Math.abs(amountVal);\\n      let catId;\\n      if (txType === \\"income\\") {\\n        catId = incomeCats[0]?.id || categories[0]?.id;\\n      } else {\\n        catId = autoCategorize(descVal, categories);\\n      }\\n      let dateStr = dateVal;\\n      if (!/\\\\d{4}-\\\\d{2}-\\\\d{2}/.test(dateVal)) {\\n        const d = new Date(dateVal);\\n        if (!isNaN(d.getTime())) {\\n          dateStr = d.toISOString().split(\\"T\\")[0];\\n        }\\n      }\\n      await addTransaction(dateStr, absAmount, catId, txType, descVal);\\n      added++;\\n    }\\n    success = `Successfully imported ${added} transactions!`;\\n    setTimeout(() => {\\n      goto(\\"/transactions\\");\\n    }, 1500);\\n  } catch (e) {\\n    error = e.message;\\n  } finally {\\n    loading = false;\\n  }\\n}\\n<\/script>\\n\\n<svelte:head>\\n  <title>Import CSV - Jim\'s Finance</title>\\n</svelte:head>\\n\\n<div class=\\"page\\">\\n  <header class=\\"page-header\\">\\n    <h1 class=\\"page-title\\">Import CSV</h1>\\n    <p class=\\"page-subtitle\\">Import transactions from your bank</p>\\n  </header>\\n  \\n  {#if error}\\n    <div class=\\"error\\">{error}</div>\\n  {/if}\\n  \\n  {#if success}\\n    <div class=\\"success\\">{success}</div>\\n  {/if}\\n  \\n  <div class=\\"card animate-fade-in\\">\\n    <p style=\\"color: var(--color-text-secondary); margin-top: 0; margin-bottom: var(--space-md);\\">\\n      Upload a bank CSV export. The app will auto-detect columns and categorize based on descriptions.\\n    </p>\\n    \\n    <div class=\\"file-input-wrapper\\">\\n      <input\\n        type=\\"file\\"\\n        accept=\\".csv\\"\\n        on:change={handleFileSelect}\\n        id=\\"csv-file\\"\\n      />\\n      <label for=\\"csv-file\\" class=\\"file-label\\">\\n        <span class=\\"file-label-icon\\">üìÅ</span>\\n        <span class=\\"file-label-text\\">\\n          {#if file}\\n            <strong>{file.name}</strong>\\n          {:else}\\n            <strong>Click to upload</strong> or drag and drop\\n          {/if}\\n        </span>\\n      </label>\\n    </div>\\n  </div>\\n  \\n  {#if columns.length > 0}\\n    <div class=\\"card mapping-card animate-fade-in stagger-1\\">\\n      <div class=\\"card-header\\">\\n        <h3 class=\\"card-title\\">üìã Column Mapping</h3>\\n      </div>\\n      \\n      <div class=\\"form-row\\">\\n        <div class=\\"form-group\\">\\n          <label>Date Column</label>\\n          <select class=\\"input\\" bind:value={dateColumn}>\\n            {#each columns as col}\\n              <option value={col}>{col}</option>\\n            {/each}\\n          </select>\\n        </div>\\n        \\n        <div class=\\"form-group\\">\\n          <label>Amount Column</label>\\n          <select class=\\"input\\" bind:value={amountColumn}>\\n            {#each columns as col}\\n              <option value={col}>{col}</option>\\n            {/each}\\n          </select>\\n        </div>\\n      </div>\\n      \\n      <div class=\\"form-group\\" style=\\"margin-bottom: 0;\\">\\n        <label>Description Column</label>\\n        <select class=\\"input\\" bind:value={descColumn}>\\n          {#each columns as col}\\n            <option value={col}>{col}</option>\\n          {/each}\\n        </select>\\n      </div>\\n    </div>\\n    \\n    {#if previewData.length > 0}\\n      <div class=\\"card preview-card animate-fade-in stagger-2\\">\\n        <div class=\\"card-header\\">\\n          <h3 class=\\"card-title\\">üëÄ Preview (First 5 rows)</h3>\\n        </div>\\n        \\n        <div class=\\"table-container\\">\\n          <table>\\n            <thead>\\n              <tr>\\n                <th>Date</th>\\n                <th>Amount</th>\\n                <th>Description</th>\\n              </tr>\\n            </thead>\\n            <tbody>\\n              {#each previewData as row}\\n                <tr>\\n                  <td>{row[dateColumn]}</td>\\n                  <td class:expense={parseFloat(row[amountColumn]?.replace(/[$,]/g, \'\') || 0) < 0}>\\n                    {row[amountColumn]}\\n                  </td>\\n                  <td>{row[descColumn]}</td>\\n                </tr>\\n              {/each}\\n            </tbody>\\n          </table>\\n        </div>\\n      </div>\\n    {/if}\\n    \\n    <button class=\\"btn btn-success import-btn animate-fade-in stagger-3\\" on:click={handleImport} disabled={loading}>\\n      {loading ? \'Importing...\' : `üì• Import ${csvData.length} Transactions`}\\n    </button>\\n  {/if}\\n</div>\\n\\n<style>\\n  .mapping-card,\\n  .preview-card {\\n    margin-bottom: var(--space-lg);\\n  }\\n  \\n  .preview-card td.expense {\\n    color: var(--color-expense);\\n  }\\n  \\n  .import-btn {\\n    width: 100%;\\n  }\\n</style>\\n"],"names":[],"mappings":"AA4NE,2CAAa,CACb,2CAAc,CACZ,aAAa,CAAE,IAAI,UAAU,CAC/B,CAEA,4BAAa,CAAC,EAAE,uBAAS,CACvB,KAAK,CAAE,IAAI,eAAe,CAC5B,CAEA,yCAAY,CACV,KAAK,CAAE,IACT"}'
};
const Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let csvData = [];
  let previewData = [];
  let dateColumn = "";
  let amountColumn = "";
  let descColumn = "";
  let columns = [];
  $$result.css.add(css);
  return `${$$result.head += `<!-- HEAD_svelte-ogr8i7_START -->${$$result.title = `<title>Import CSV - Jim&#39;s Finance</title>`, ""}<!-- HEAD_svelte-ogr8i7_END -->`, ""} <div class="page"><header class="page-header" data-svelte-h="svelte-1ghwfa0"><h1 class="page-title">Import CSV</h1> <p class="page-subtitle">Import transactions from your bank</p></header> ${``} ${``} <div class="card animate-fade-in"><p style="color: var(--color-text-secondary); margin-top: 0; margin-bottom: var(--space-md);" data-svelte-h="svelte-1lhuqy1">Upload a bank CSV export. The app will auto-detect columns and categorize based on descriptions.</p> <div class="file-input-wrapper"><input type="file" accept=".csv" id="csv-file"> <label for="csv-file" class="file-label"><span class="file-label-icon" data-svelte-h="svelte-1bmcvhm">üìÅ</span> <span class="file-label-text">${`<strong data-svelte-h="svelte-1r0qvlo">Click to upload</strong> or drag and drop`}</span></label></div></div> ${columns.length > 0 ? `<div class="card mapping-card animate-fade-in stagger-1 svelte-1hswut0"><div class="card-header" data-svelte-h="svelte-i6d7o8"><h3 class="card-title">üìã Column Mapping</h3></div> <div class="form-row"><div class="form-group"><label data-svelte-h="svelte-1ks9712">Date Column</label> <select class="input">${each(columns, (col) => {
    return `<option${add_attribute("value", col, 0)}>${escape(col)}</option>`;
  })}</select></div> <div class="form-group"><label data-svelte-h="svelte-s33pnq">Amount Column</label> <select class="input">${each(columns, (col) => {
    return `<option${add_attribute("value", col, 0)}>${escape(col)}</option>`;
  })}</select></div></div> <div class="form-group" style="margin-bottom: 0;"><label data-svelte-h="svelte-1iuf2ic">Description Column</label> <select class="input">${each(columns, (col) => {
    return `<option${add_attribute("value", col, 0)}>${escape(col)}</option>`;
  })}</select></div></div> ${previewData.length > 0 ? `<div class="card preview-card animate-fade-in stagger-2 svelte-1hswut0"><div class="card-header" data-svelte-h="svelte-19oqoz2"><h3 class="card-title">üëÄ Preview (First 5 rows)</h3></div> <div class="table-container"><table><thead data-svelte-h="svelte-rx10jy"><tr><th>Date</th> <th>Amount</th> <th>Description</th></tr></thead> <tbody>${each(previewData, (row) => {
    return `<tr><td>${escape(row[dateColumn])}</td> <td class="${[
      "svelte-1hswut0",
      parseFloat(row[amountColumn]?.replace(/[$,]/g, "") || 0) < 0 ? "expense" : ""
    ].join(" ").trim()}">${escape(row[amountColumn])}</td> <td>${escape(row[descColumn])}</td> </tr>`;
  })}</tbody></table></div></div>` : ``} <button class="btn btn-success import-btn animate-fade-in stagger-3 svelte-1hswut0" ${""}>${escape(`üì• Import ${csvData.length} Transactions`)}</button>` : ``} </div>`;
});
export {
  Page as default
};
