import { c as create_ssr_component, e as each, d as add_attribute, f as escape } from "../../../chunks/ssr.js";
import "@sveltejs/kit/internal";
import "../../../chunks/exports.js";
import "../../../chunks/utils.js";
import "@sveltejs/kit/internal/server";
import "../../../chunks/state.svelte.js";
import "../../../chunks/supabase.js";
const css = {
  code: ".description.svelte-jlfbge.svelte-jlfbge{color:#94a3b8;margin-top:0}.file-input.svelte-jlfbge.svelte-jlfbge{position:relative}.file-input.svelte-jlfbge input.svelte-jlfbge{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}.file-label.svelte-jlfbge.svelte-jlfbge{display:block;padding:2rem;border:2px dashed #334155;border-radius:0.75rem;text-align:center;cursor:pointer;transition:all 0.2s}.file-label.svelte-jlfbge.svelte-jlfbge:hover{border-color:#3b82f6;background-color:rgba(59, 130, 246, 0.05)}.mapping-card.svelte-jlfbge h3.svelte-jlfbge,.preview-card.svelte-jlfbge h3.svelte-jlfbge{margin-top:0}.preview-card.svelte-jlfbge td.expense.svelte-jlfbge{color:#ef4444}.import-btn.svelte-jlfbge.svelte-jlfbge{width:100%}.success.svelte-jlfbge.svelte-jlfbge{background-color:rgba(34, 197, 94, 0.1);border:1px solid #22c55e;color:#22c55e;padding:1rem;border-radius:0.5rem;margin-bottom:1rem}",
  map: '{"version":3,"file":"+page.svelte","sources":["+page.svelte"],"sourcesContent":["<script lang=\\"ts\\">import { onMount } from \\"svelte\\";\\nimport { goto } from \\"$app/navigation\\";\\nimport { addTransaction, getCategories, autoCategorize } from \\"$lib/api\\";\\nlet loading = false;\\nlet error = \\"\\";\\nlet success = \\"\\";\\nlet categories = [];\\nlet file = null;\\nlet csvData = [];\\nlet previewData = [];\\nlet dateColumn = \\"\\";\\nlet amountColumn = \\"\\";\\nlet descColumn = \\"\\";\\nlet columns = [];\\nonMount(async () => {\\n  categories = await getCategories();\\n});\\nfunction handleFileSelect(event) {\\n  const input = event.target;\\n  if (input.files && input.files[0]) {\\n    file = input.files[0];\\n    parseCSV(file);\\n  }\\n}\\nfunction parseCSV(file2) {\\n  const reader = new FileReader();\\n  reader.onload = (e) => {\\n    const text = e.target?.result;\\n    const lines = text.split(\\"\\\\n\\").filter((l) => l.trim());\\n    if (lines.length < 2) {\\n      error = \\"CSV file is empty or invalid\\";\\n      return;\\n    }\\n    const headers = lines[0].split(\\",\\").map((h) => h.trim().replace(/^\\"|\\"$/g, \\"\\"));\\n    columns = headers;\\n    dateColumn = headers.find(\\n      (h) => /date|day|time/i.test(h)\\n    ) || headers[0];\\n    amountColumn = headers.find(\\n      (h) => /amount|sum|value|price|cost/i.test(h)\\n    ) || headers.find((h) => /^-?\\\\$?\\\\d/.test(h)) || headers[1];\\n    descColumn = headers.find(\\n      (h) => /desc|memo|note|payee|name|merchant|transaction/i.test(h)\\n    ) || headers[2] || headers[headers.length - 1];\\n    csvData = [];\\n    for (let i = 1; i < lines.length && i <= 100; i++) {\\n      const values = lines[i].split(\\",\\").map((v) => v.trim().replace(/^\\"|\\"$/g, \\"\\"));\\n      const row = {};\\n      headers.forEach((h, idx) => {\\n        row[h] = values[idx] || \\"\\";\\n      });\\n      csvData.push(row);\\n    }\\n    previewData = csvData.slice(0, 5);\\n  };\\n  reader.readAsText(file2);\\n}\\nasync function handleImport() {\\n  if (!dateColumn || !amountColumn || !descColumn || csvData.length === 0) {\\n    error = \\"Please map all columns first\\";\\n    return;\\n  }\\n  loading = true;\\n  error = \\"\\";\\n  try {\\n    let added = 0;\\n    const expenseCats = categories.filter((c) => c.is_income === 0);\\n    const incomeCats = categories.filter((c) => c.is_income === 1);\\n    for (const row of csvData) {\\n      const dateVal = row[dateColumn];\\n      const amountVal = parseFloat(row[amountColumn].replace(/[$,]/g, \\"\\"));\\n      const descVal = row[descColumn];\\n      if (isNaN(amountVal)) continue;\\n      const txType = amountVal > 0 ? \\"income\\" : \\"expense\\";\\n      const absAmount = Math.abs(amountVal);\\n      let catId;\\n      if (txType === \\"income\\") {\\n        catId = incomeCats[0]?.id || categories[0]?.id;\\n      } else {\\n        catId = autoCategorize(descVal, categories);\\n      }\\n      let dateStr = dateVal;\\n      if (!/\\\\d{4}-\\\\d{2}-\\\\d{2}/.test(dateVal)) {\\n        const d = new Date(dateVal);\\n        if (!isNaN(d.getTime())) {\\n          dateStr = d.toISOString().split(\\"T\\")[0];\\n        }\\n      }\\n      await addTransaction(dateStr, absAmount, catId, txType, descVal);\\n      added++;\\n    }\\n    success = `Successfully imported ${added} transactions!`;\\n    setTimeout(() => {\\n      goto(\\"/transactions\\");\\n    }, 1500);\\n  } catch (e) {\\n    error = e.message;\\n  } finally {\\n    loading = false;\\n  }\\n}\\n<\/script>\\n\\n<svelte:head>\\n  <title>Import CSV - Jim\'s Finance Tracker</title>\\n</svelte:head>\\n\\n<div class=\\"page\\">\\n  <h1 class=\\"page-title\\">üìÅ Import CSV</h1>\\n  \\n  {#if error}\\n    <div class=\\"error\\">{error}</div>\\n  {/if}\\n  \\n  {#if success}\\n    <div class=\\"success\\">{success}</div>\\n  {/if}\\n  \\n  <div class=\\"card\\">\\n    <p class=\\"description\\">\\n      Upload a bank CSV export to import transactions. \\n      The app will auto-detect columns and categorize based on descriptions.\\n    </p>\\n    \\n    <div class=\\"file-input\\">\\n      <input\\n        type=\\"file\\"\\n        accept=\\".csv\\"\\n        on:change={handleFileSelect}\\n        id=\\"csv-file\\"\\n      />\\n      <label for=\\"csv-file\\" class=\\"file-label\\">\\n        {#if file}\\n          üìÑ {file.name}\\n        {:else}\\n          üìÅ Choose CSV File\\n        {/if}\\n      </label>\\n    </div>\\n  </div>\\n  \\n  {#if columns.length > 0}\\n    <div class=\\"card mapping-card\\">\\n      <h3>üìã Column Mapping</h3>\\n      \\n      <div class=\\"form-row\\">\\n        <div class=\\"form-group\\">\\n          <label>Date Column</label>\\n          <select class=\\"input\\" bind:value={dateColumn}>\\n            {#each columns as col}\\n              <option value={col}>{col}</option>\\n            {/each}\\n          </select>\\n        </div>\\n        \\n        <div class=\\"form-group\\">\\n          <label>Amount Column</label>\\n          <select class=\\"input\\" bind:value={amountColumn}>\\n            {#each columns as col}\\n              <option value={col}>{col}</option>\\n            {/each}\\n          </select>\\n        </div>\\n      </div>\\n      \\n      <div class=\\"form-group\\">\\n        <label>Description Column</label>\\n        <select class=\\"input\\" bind:value={descColumn}>\\n          {#each columns as col}\\n            <option value={col}>{col}</option>\\n          {/each}\\n        </select>\\n      </div>\\n    </div>\\n    \\n    {#if previewData.length > 0}\\n      <div class=\\"card preview-card\\">\\n        <h3>üëÄ Preview (First 5 rows)</h3>\\n        \\n        <div class=\\"table-container\\">\\n          <table>\\n            <thead>\\n              <tr>\\n                <th>Date</th>\\n                <th>Amount</th>\\n                <th>Description</th>\\n              </tr>\\n            </thead>\\n            <tbody>\\n              {#each previewData as row}\\n                <tr>\\n                  <td>{row[dateColumn]}</td>\\n                  <td class:expense={parseFloat(row[amountColumn]?.replace(/[$,]/g, \'\') || 0) < 0}>\\n                    {row[amountColumn]}\\n                  </td>\\n                  <td>{row[descColumn]}</td>\\n                </tr>\\n              {/each}\\n            </tbody>\\n          </table>\\n        </div>\\n      </div>\\n    {/if}\\n    \\n    <button class=\\"btn btn-success import-btn\\" on:click={handleImport} disabled={loading}>\\n      {loading ? \'Importing...\' : `üì• Import ${csvData.length} Transactions`}\\n    </button>\\n  {/if}\\n</div>\\n\\n<style>\\n  .description {\\n    color: #94a3b8;\\n    margin-top: 0;\\n  }\\n  \\n  .file-input {\\n    position: relative;\\n  }\\n  \\n  .file-input input {\\n    position: absolute;\\n    opacity: 0;\\n    width: 100%;\\n    height: 100%;\\n    cursor: pointer;\\n  }\\n  \\n  .file-label {\\n    display: block;\\n    padding: 2rem;\\n    border: 2px dashed #334155;\\n    border-radius: 0.75rem;\\n    text-align: center;\\n    cursor: pointer;\\n    transition: all 0.2s;\\n  }\\n  \\n  .file-label:hover {\\n    border-color: #3b82f6;\\n    background-color: rgba(59, 130, 246, 0.05);\\n  }\\n  \\n  .mapping-card h3,\\n  .preview-card h3 {\\n    margin-top: 0;\\n  }\\n  \\n  .preview-card td.expense {\\n    color: #ef4444;\\n  }\\n  \\n  .import-btn {\\n    width: 100%;\\n  }\\n  \\n  .success {\\n    background-color: rgba(34, 197, 94, 0.1);\\n    border: 1px solid #22c55e;\\n    color: #22c55e;\\n    padding: 1rem;\\n    border-radius: 0.5rem;\\n    margin-bottom: 1rem;\\n  }\\n</style>\\n"],"names":[],"mappings":"AAmNE,wCAAa,CACX,KAAK,CAAE,OAAO,CACd,UAAU,CAAE,CACd,CAEA,uCAAY,CACV,QAAQ,CAAE,QACZ,CAEA,yBAAW,CAAC,mBAAM,CAChB,QAAQ,CAAE,QAAQ,CAClB,OAAO,CAAE,CAAC,CACV,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IAAI,CACZ,MAAM,CAAE,OACV,CAEA,uCAAY,CACV,OAAO,CAAE,KAAK,CACd,OAAO,CAAE,IAAI,CACb,MAAM,CAAE,GAAG,CAAC,MAAM,CAAC,OAAO,CAC1B,aAAa,CAAE,OAAO,CACtB,UAAU,CAAE,MAAM,CAClB,MAAM,CAAE,OAAO,CACf,UAAU,CAAE,GAAG,CAAC,IAClB,CAEA,uCAAW,MAAO,CAChB,YAAY,CAAE,OAAO,CACrB,gBAAgB,CAAE,KAAK,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAC3C,CAEA,2BAAa,CAAC,gBAAE,CAChB,2BAAa,CAAC,gBAAG,CACf,UAAU,CAAE,CACd,CAEA,2BAAa,CAAC,EAAE,sBAAS,CACvB,KAAK,CAAE,OACT,CAEA,uCAAY,CACV,KAAK,CAAE,IACT,CAEA,oCAAS,CACP,gBAAgB,CAAE,KAAK,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CACxC,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,OAAO,CACzB,KAAK,CAAE,OAAO,CACd,OAAO,CAAE,IAAI,CACb,aAAa,CAAE,MAAM,CACrB,aAAa,CAAE,IACjB"}'
};
const Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let csvData = [];
  let previewData = [];
  let dateColumn = "";
  let amountColumn = "";
  let descColumn = "";
  let columns = [];
  $$result.css.add(css);
  return `${$$result.head += `<!-- HEAD_svelte-1u7g53n_START -->${$$result.title = `<title>Import CSV - Jim&#39;s Finance Tracker</title>`, ""}<!-- HEAD_svelte-1u7g53n_END -->`, ""} <div class="page"><h1 class="page-title" data-svelte-h="svelte-kvwomw">üìÅ Import CSV</h1> ${``} ${``} <div class="card"><p class="description svelte-jlfbge" data-svelte-h="svelte-p70p7r">Upload a bank CSV export to import transactions. 
      The app will auto-detect columns and categorize based on descriptions.</p> <div class="file-input svelte-jlfbge"><input type="file" accept=".csv" id="csv-file" class="svelte-jlfbge"> <label for="csv-file" class="file-label svelte-jlfbge">${`üìÅ Choose CSV File`}</label></div></div> ${columns.length > 0 ? `<div class="card mapping-card svelte-jlfbge"><h3 class="svelte-jlfbge" data-svelte-h="svelte-e3kp6a">üìã Column Mapping</h3> <div class="form-row"><div class="form-group"><label data-svelte-h="svelte-1ks9712">Date Column</label> <select class="input">${each(columns, (col) => {
    return `<option${add_attribute("value", col, 0)}>${escape(col)}</option>`;
  })}</select></div> <div class="form-group"><label data-svelte-h="svelte-s33pnq">Amount Column</label> <select class="input">${each(columns, (col) => {
    return `<option${add_attribute("value", col, 0)}>${escape(col)}</option>`;
  })}</select></div></div> <div class="form-group"><label data-svelte-h="svelte-1iuf2ic">Description Column</label> <select class="input">${each(columns, (col) => {
    return `<option${add_attribute("value", col, 0)}>${escape(col)}</option>`;
  })}</select></div></div> ${previewData.length > 0 ? `<div class="card preview-card svelte-jlfbge"><h3 class="svelte-jlfbge" data-svelte-h="svelte-1fp2b5w">üëÄ Preview (First 5 rows)</h3> <div class="table-container"><table><thead data-svelte-h="svelte-rx10jy"><tr><th>Date</th> <th>Amount</th> <th>Description</th></tr></thead> <tbody>${each(previewData, (row) => {
    return `<tr><td>${escape(row[dateColumn])}</td> <td class="${[
      "svelte-jlfbge",
      parseFloat(row[amountColumn]?.replace(/[$,]/g, "") || 0) < 0 ? "expense" : ""
    ].join(" ").trim()}">${escape(row[amountColumn])}</td> <td>${escape(row[descColumn])}</td> </tr>`;
  })}</tbody></table></div></div>` : ``} <button class="btn btn-success import-btn svelte-jlfbge" ${""}>${escape(`üì• Import ${csvData.length} Transactions`)}</button>` : ``} </div>`;
});
export {
  Page as default
};
